FROM ubuntu:focal

RUN apt-get update   && \
    apt-get -y upgrade   && \
    apt-get -y --no-install-recommends install openssl shellinabox ca-certificates iputils-ping wget jq curl dnsutils && \
    adduser lab --gecos "Me,Office,WorkPhone,HomePhone" --disabled-password  && \
    echo 'lab:$6$88GqT260$I8mtFOPBqCSeDWUdDcWBV0oDR1c2NAbg7WFh/6n6cb60sWdXhLJDQ6ELEAIErDr2p5syvVZkcsualGt4pC8Es1' | chpasswd --encrypted 

LABEL version="1.38"
LABEL description="Test with Labels in Image"
LABEL application="true"
LABEL deployment="QA"

ENV MYSQL_HOST=DB_Server
ENV MYSQL_USER=operations
ENV MYSQL_PASSWORD=5TTnvuTDJJSqikdyfvueew

EXPOSE 4200

ENTRYPOINT ["shellinaboxd", "-s", "/:LOGIN", "--disable-ssl"]

# Twistlock Container Defender - app embedded
ADD twistlock_defender_app_embedded.tar.gz .tmp
ENV DEFENDER_TYPE="appEmbedded"
ENV DEFENDER_APP_ID="shellapp"
ENV WS_ADDRESS="wss://looconsole2009.southeastasia.cloudapp.azure.com:8084"
ENV DATA_FOLDER=".tmp"
ENV INSTALL_BUNDLE="eyJzZWNyZXRzIjp7ImNhLnBlbSI6Ii0tLS0tQkVHSU4gQ0VSVElGSUNBVEUtLS0tLVxuTUlJQy9qQ0NBZWFnQXdJQkFnSVJBS2N6YTMyV1crN3JaazIwTGM3bDNTVXdEUVlKS29aSWh2Y05BUUVMQlFBd1xuS0RFU01CQUdBMVVFQ2hNSlZIZHBjM1JzYjJOck1SSXdFQVlEVlFRREV3bFVkMmx6ZEd4dlkyc3dIaGNOTWpBeFxuTURBME1EY3hOREF3V2hjTk1qTXhNREEwTURjeE5EQXdXakFvTVJJd0VBWURWUVFLRXdsVWQybHpkR3h2WTJzeFxuRWpBUUJnTlZCQU1UQ1ZSM2FYTjBiRzlqYXpDQ0FTSXdEUVlKS29aSWh2Y05BUUVCQlFBRGdnRVBBRENDQVFvQ1xuZ2dFQkFOaGtmY2M1N1Q0K2hnNm9IeU1jdHFER2tNYTVBZmkxa0UvTGt2ZEhlME5UTTN1OFVNV1pVMlgvc3d5NlxuMTlYR0c5VmljbkhzR2MrTkNDaGF0K2lGd3U1OTlsb2dDYlk2Y3JwdU9yUXloNFA1MFBMZEw1RE9HVE9JUWZhU1xuSXNGVWlSQ0dudEo4TnZrWll2WE5Nd0E0M2QveUFQNmFxbUIxQ2c3Y3prWDh1TUZ1YklOWFdBOTNXd2NIcEYxMlxuMGMrcGZFUlJjK3phei9IOE5pUmtYdkhBMVVsR0dZTVJOMWYwbHBxdUlJQi91KzRpcFgrb2Q2WW1TNFIxdDRkWFxudWducjAwcmExVWhpbUhNSHdhekFrbVNrajU2MU0xMVhtSjZwb1NkTExwb3dHRUxyQlRxQzNUQmlhY1N3OTJqRVxuN2F0RmFVKzNpZVNROFU3S002MjJYaXJGZUVjQ0F3RUFBYU1qTUNFd0RnWURWUjBQQVFIL0JBUURBZ0tzTUE4R1xuQTFVZEV3RUIvd1FGTUFNQkFmOHdEUVlKS29aSWh2Y05BUUVMQlFBRGdnRUJBS0xvL09qUSt4VytUdmUzczZmeFxuZGY1R3JGNXQ1U1dkMFovUE04WlFmNWlQcUkyalh5MHVqa2lQMDdqVXJRWHFKdkl1Ky80UGZzZFozS0V0djk4T1xuTXpzNStRQjBaVE9FbUhpZGhudktmL2hudTRKTmVBaXMvRjQrM2pyeEk1ckhyRTVvR1lpcDhqN2JXaVVoVXh0QlxuQTRCL0Z5ZFVCd1czYzIrSkF2RG0vdExGWUl6Q0djVzZnS2g5M29zbXdDRHdCdlZ6bWVrN1hoV25ra2x2ODNyY1xuR1RmSTl0RWNTa0pNdGoxZ2pqQldXREF1Y0JZem91L0VIRGJ3aTBoSUNQOG85dUt5NHcxZ1FHc2liUWdFTW1EdlxudEJzY21iUGFKbmFPdUQzU0huU01WNElCUUxNNm9kUFNGeCtPVHBJZ1E0SFRvZUZob0dZQjd2THYyOXM4a04vZ1xubXRVPVxuLS0tLS1FTkQgQ0VSVElGSUNBVEUtLS0tLVxuIiwiY2xpZW50LWNlcnQucGVtIjoiLS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tXG5NSUlER2pDQ0FnS2dBd0lCQWdJUUF3Qjg0dWJJYURRVUUxWng1eDZqc3pBTkJna3Foa2lHOXcwQkFRc0ZBREFvXG5NUkl3RUFZRFZRUUtFd2xVZDJsemRHeHZZMnN4RWpBUUJnTlZCQU1UQ1ZSM2FYTjBiRzlqYXpBZUZ3MHlNVEF4XG5NRFl3TXpNeU1EQmFGdzB5TkRBeE1EWXdNek15TURCYU1DZ3hFakFRQmdOVkJBb1RDVlIzYVhOMGJHOWphekVTXG5NQkFHQTFVRUF4TUpiRzlqWVd4b2IzTjBNSUlCSWpBTkJna3Foa2lHOXcwQkFRRUZBQU9DQVE4QU1JSUJDZ0tDXG5BUUVBdGhxejF6Q0pTVEVjVEZBUU84RldRdXBubGpOWkZiQXBGRFBRMjBNQmJ0aVhrZ05HVVZBT21ISEF6MktGXG4rUGdFNWJjQ1NGU1pZdE4yODY2T0J3VkZlWllsYVZycUVKb25YVzJWL1JTSFloVy9SRlZzdmFYb3FKR2ozY201XG5vVFR2akoyZlR6dlNycGxZbVhjOUpWNHp1bzFsWEFkWWFTYW1ZaEJObkpuWW1nNzZjTC9NUzM1YXZMaFNGOE95XG5VcjlxSEZkeVJSUzlHWGd1OE5SUkNSbXBIK0o3ZERWMVRFd3cyK2NCSzJlRk9YYndKdjlUTkw3UnJFeDkraFd0XG5STmZoSG5oUnRCeFpSaTh2RFhtZms4UVh2TjRVQjNLRUhac0VrSzA3SXlSK1pCMTc2NzBMYlJYdkdaVDRLYkJIXG5RNUV0WUxPdk5nbkxVMFlPZzFNdSs0cXlUd0lEQVFBQm8wQXdQakFPQmdOVkhROEJBZjhFQkFNQ0I0QXdFd1lEXG5WUjBsQkF3d0NnWUlLd1lCQlFVSEF3SXdEQVlEVlIwVEFRSC9CQUl3QURBSkJnVXFCQUVDQndRQU1BMEdDU3FHXG5TSWIzRFFFQkN3VUFBNElCQVFBK3VFTjhvZ1BFcUNsWTFoTFRnUGRzWCtYeHFFVmQ5UURKMHpEVDVxRVBLTDBRXG5wcWRzVmp0QW1oUWpaVFRBZkR2U2J3cE5ra0dTNFBtNFRkd3RCaHNJQU1lTTBhR2dJRWxjK2RGN2hHK1BNRGNnXG5INXhBVUJqcXlhZllRaDlTbTZnREF2UHd4d2s0WUhnS0tyUVV4eE5FVUIxL3czWFpsNHpEeHo4SGNGdnJKM1RZXG52STB6L0tRVkpnRExLb0YzeFY4QVBTNmlna2YrZjk4Y0FHSXF4b2thTTFXSTdjclY1UUxYZmZuYzlVV2Y2MlY5XG5weHBKZjJkcjlOZlZYQ20vNENreFhHeDJFYWhIZExSMTBjWVRrbnFGSVBsUmxtOGV6dkd2UHQ2cDJvd0pXaEc2XG5mMG9RRFkzZ3FacFl2VHdMNDFjOVplZFhCVS9kc1g1NlJLRDNBZmZwXG4tLS0tLUVORCBDRVJUSUZJQ0FURS0tLS0tXG4iLCJjbGllbnQta2V5LnBlbSI6Ii0tLS0tQkVHSU4gUlNBIFBSSVZBVEUgS0VZLS0tLS1cblByb2MtVHlwZTogNCxFTkNSWVBURURcbkRFSy1JbmZvOiBBRVMtMjU2LUNCQyxjOGNkYTYyNWIzYTVmNDNkZjA3MTM3N2VkYWU4Njg4NVxuXG5ic01XVlBReXd2aVpRRTk2dTJGVlFyTzVrcGdka2F1bFZCZHpIYlFBYlJaanE1cXRudmlOZmppWmRXOEM4Qll0XG5zVUNkdjlXVmwxSCtIamFQN3VXZEQxMkMvU1EzOU5leWl2cm5hRzY2enlvMGFHcHlSMzhEZE94RUFlRE5FRGtYXG5WdlJSMzZRQVYwVWs1TTlTWDZxT05CWC91c0J4SnhqUzJiT3h5SmJlcEp4THJHNE1UMGd1Q3JVb0dUcnhPY0NXXG50eXRlM0E1TFI5VnViVkxtdHQxVEJYRm8wdUQvWUV4RXduY0IrQXBKRThFenB5SjE0d1lHVDI0SWt0RElJaHUxXG4wZlcrVkJKays5bEljVFpCMk5DQ1lHT3lTUFBzMnhUS01sWHB4aVF2WURVTEk5WU1xaCsrNHJiY2N2SmRDMDVVXG42RlFQZ29vQVFSRnN2dG9oS2ZPSEZJaTlDSGVMRXBaQnlla00rUTcrU0JKYXNMcXlPZCtlbHVVSHJqMC85RmxvXG5kNTlNWkRoV3FrQWVQeGpDY3R1Qzk5ZHdMdjlkS0tvWEdUem1TY2ZBRmM0ZzBZV3pQT3dxNG1ySlBPdm5DM1RkXG5HaEk5dDZPMVJmYjFqUmhkV3dhTHViMHh5OS9mOFN2VDg2enFiMmlyVEQzZjllVU5KZDlQU09SYm5rWnNVY3JjXG52MGF1NjFOUUlGTkpXSXZDK0t1ZmVQaEh1aHFEa3JtNWRtaFhhQmRaTTBRQjgyZW1ONTMvL0c2NTZqU3htL0dHXG5Cc2Y1YXZxTEpkMXRMWkZpNzl0dmpTdDlEM0R6QU1ueHBBYkJJak53b1dkN0VQaDRFZ3BTUTJjcERta1pCQWV5XG5KQmdsdTZnT3JRQlkrdnJOQ3ErVXUwUFIrSEtBVUdkQXVTTVlQZHZWeFU2SDVROUZneUV5c0NPc2REVjhkMm5rXG5VdUxIT2lkaVAzQmZDVURNS1hycW9mejN6SUhUaUkzejIyeE1QZFAvcnFtMUcyTXk3RGxkc0FkelkrejZMZ3U0XG5jZXU4MHZBUnJjOFJOWEZ4VFFnMFQ2VC9KVk91T3V1Y0FEeHRXR0FqSzg2ZE5tNmRjd0Y0cVNiNUt5QVJDV2JjXG5oMnhpWHhLeHc0ZCt4cGZPbUJlUWxEZ2tjQi9Wbm04MUZsWjBnK3BHVFpIY29mSWJlN2NqMWxuQW5ZTEh2a1hTXG5KVE9WZUtyR01uUkRhaTRVemFHWThCOHZuY3hWT3doY1ZNb1RIcG1yUmRqRnlHT1d1WWVwMmI4Q0FyMnQ0R0pCXG5LSFZFakxuQy9YK2g4SVhKVDNEdXdzV1hJZHBjSU5hMUZRcXdPTDBRYytSN0N1WERObkNRUkJDeGU5dTBsckpzXG5CQjNvTHY0MjU3VFNJRHZkV0cxTXR0QUUzMVB6ZVZTcG1QRTZrbzZCelZkbklGR08xbzBSYjBmdW9HNjdHTEJlXG5sbVZ3WTNCc2NFNVVHRVl6SnZNeW52YkEzS0o1OFFOMDE1bUg2R2hUNTdJMzhMVFQ2Nkt3aW9UcHAwMTNZQkg1XG5Td0svVHdib2R2SERBRmpOVTlIb2xMdnhsT2NPZ0ZLcWZxSGZZeVE3YWRDMS8zM1MvRmMxeXE1Vnh6bmF6UXQ5XG5aT1ltazhRSjJDcm5ucVh2MUQvSGVPenNOdy9yQkJZTEF1Q2FiR2xJVlJ5OFR3RW55Rm9vQXUwS1VlZWxCeWEwXG5jOUdsYzJFRXhnbUxyb3VlcmI4RkN5cllpazV0RXFPdktyV1dHZzZSWnJPcmtyMFNjaGxydzlpdHppNUQyUmJVXG5nZVZCY3o2NWJxNFBhWHE0RnVIUUxSUkM0bkpOa3dwWGdFRXdDYVozMWh2SmppbjZTMXdZenc3b0twUzU5anozXG5lSEY3eFhzVFgrdk44SjU3b0hHYkV1WGpkQjJ2MC9VNDFkMFRSVFNvMzFPcUJsRCtGbFp6TkJGME9objF4aVJTXG5INUZRZmlMMmh5WWpwc2s5YU1Kb001Smg0NFFxc29PUnpjVXhPMDZPYmRONkJDUG02UGNHWVRZVmRhMVMxUXhsXG5JN1dYRXNCSWtYWUNBQ2grMHBBdHZpT2s2VTFHZFFFYk9rUExJR2FIM3ROUTZmVTR0VkVjcS9oeE5KS3NFeUhLXG4tLS0tLUVORCBSU0EgUFJJVkFURSBLRVktLS0tLVxuIiwic2VydmljZS1wYXJhbWV0ZXIiOiJmcUp6MndEdC9INzhTamF6TUVHclI3YStzWTg3Q3dyZWlBSldYb3NuNTBJbGt6eU9GVStVVmdEck5zQ2xBNENCUWxLR0xnNW5tQnAzV0gyNG1qSHRzUT09In0sImdsb2JhbFByb3h5T3B0Ijp7Imh0dHBQcm94eSI6IiIsIm5vUHJveHkiOiIiLCJjYSI6IiIsInVzZXIiOiIiLCJwYXNzd29yZCI6eyJlbmNyeXB0ZWQiOiIifX0sIm1pY3Jvc2VnQ29tcGF0aWJsZSI6ZmFsc2V9"
ENTRYPOINT [".tmp/defender", "app-embedded", "shellinaboxd", "-s", "/:LOGIN", "--disable-ssl"]
